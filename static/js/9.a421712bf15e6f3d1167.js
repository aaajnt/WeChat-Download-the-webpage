(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"2znC":function(e,t,n){"use strict"},UpRn:function(e,t,n){"use strict";var i=n("FyfS"),r=n.n(i),o=n("yp9N");t.a={install:function(e,t){var n=new o.a.Notify({type:o.a.WEBAPPSOCKET_TYPE});e.webappsocketauth=n.auth.bind(n),e.webappsocketsend=n.send.bind(n),e.closewebappsocketauth=n.destory.bind(n);var i=[];e.mixin({beforeDestroy:function(){if(this.onAeSocketMsg){var e=i.indexOf(this.onAeSocketMsg);i.splice(e,1)}},created:function(){this.onAeSocketMsg&&i.push(this.onAeSocketMsg)}}),n.onmessage(function(){var e=!0,t=!1,n=void 0;try{for(var o,a=r()(i);!(e=(o=a.next()).done);e=!0){o.value.apply(void 0,arguments)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}})}}},"uY/h":function(e,t,n){"use strict";var i=n("P2sY"),r=n.n(i),o=n("gDS+"),a=n.n(o),s=n("EJiy"),u=n.n(s),c=parseInt((document.cookie.match(/\bwxuin=\D*(\d+)/)||[])[1],10);var l=function(e){if(e.BJ_REPORT)return e.BJ_REPORT;var t=[],n={},i={id:0,uin:0,url:"",offline_url:"",offline_auto_url:"",ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:5,offlineLog:!1,offlineLogExp:5,offlineLogAuto:!1,getUin:null,prepareParams:null},r={db:null,ready:function(e){var t=this;if(!window.indexedDB||!i.offlineLog)return i.offlineLog=!1,e();if(this.db)setTimeout(function(){e(null,t)},0);else{var n=window.indexedDB.open("badjs",1);if(!n)return i.offlineLog=!1,e();n.onerror=function(t){return e(t),i.offlineLog=!1,!0},n.onsuccess=function(n){t.db=n.target.result,setTimeout(function(){e(null,t)},500)},n.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains("logs")||t.createObjectStore("logs",{autoIncrement:!0})}}},insertToDB:function(e){this.getStore().add(e)},addLog:function(e){this.db&&this.insertToDB(e)},addLogs:function(e){if(this.db)for(var t=0;t<e.length;t++)this.addLog(e[t])},getLogs:function(e,t){if(this.db){var n=this.getStore().openCursor(),i=[];n.onsuccess=function(n){var r=n.target.result;r?(r.value.time>=e.start&&r.value.time<=e.end&&r.value.id==e.id&&r.value.uin==e.uin&&i.push(r.value),r.continue()):t(null,i)},n.onerror=function(e){return t(e),!0}}},clearDB:function(e){if(this.db){var t=this.getStore();if(e){var n=Date.now()-24*(e||2)*3600*1e3;t.openCursor().onsuccess=function(e){var i=e.target.result;i&&(i.value.time<n||!i.value.time)&&(t.delete(i.primaryKey),i.continue())}}else t.clear()}},getStore:function(){return this.db.transaction("logs","readwrite").objectStore("logs")}},o={isOBJByType:function(e,t){return Object.prototype.toString.call(e)==="[object "+(t||"Object")+"]"},isOBJ:function(e){return"object"===(void 0===e?"undefined":u()(e))&&!!e},isEmpty:function(e){return null===e||!o.isOBJByType(e,"Number")&&!e},extend:function(e,t){for(var n in t)e[n]=t[n];return e},processError:function(e){var t=e.time;try{if(e.stack){var n=e.stack.match("https?://[^\n]+"),i=(n=n?n[0]:"").match(":(\\d+):(\\d+)");i||(i=[0,0,0]);var r=o.processStackMsg(e),s=r.stack;return{error:r.error,msg:s,rowNum:i[1],colNum:i[2],target:n.replace(i[0],""),_orgMsg:e.toString(),time:t}}return e.name&&e.message&&e.description?{msg:a()(e),time:t}:e}catch(t){return e}},processStackMsg:function(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),n=e.toString();return t.indexOf(n)<0&&(t=n+"@"+t),{stack:t,error:n}},isRepeat:function(e){if(!o.isOBJ(e))return!0;var t=e.msg;return(n[t]=(parseInt(n[t],10)||0)+1)>i.repeat}},s=e.onerror;e.onerror=function(t,n,i,r,a){var u,c=t,l=a&&a.toString&&a.toString();a&&a.stack&&(c=(u=o.processStackMsg(a)).msg,l=u.error),o.isOBJByType(c,"Event")&&(c+=c.type?"--"+c.type+"--"+(c.target?c.target.tagName+"::"+c.target.src:""):""),m.push({msg:c,error:l,target:n,rowNum:i,colNum:r,_orgMsg:t,time:Date.now()}),g(),s&&s.apply(e,arguments)};var c=function(e,t){var n=[],r=[],s=[];if(o.isOBJ(e))for(var u in e.level=e.level||i.level,e){var c=e[u],l=encodeURIComponent(c);if(!o.isEmpty(c)){if(o.isOBJ(c))try{c=a()(c)}catch(e){c="[BJ_REPORT detect value stringify error] "+e.toString()}s.push(u+":"+c),n.push(u+"="+l),r.push(u+"["+t+"]="+l)}}return[r.join("&"),s.join(","),n.join("&"),e]},f=[],p=[],d=0,h=function(){var e;if(clearTimeout(d),p.length){if(e=i.prepareParams?i.prepareParams(p,i):i._reportUrl+p.join("&")+"&count="+p.length+"&_t="+ +new Date,i.submit)i.submit(e);else(new Image).src=e;d=0,p=[]}},g=function(e){if(i._reportUrl){for(var n,a=Math.random()>=i.random;t.length;){var s=!1,u=t.shift();if(u.msg=(u.msg+""||"").substr(0,500),!o.isRepeat(u)){var l=c(u,p.length);if(o.isOBJByType(i.ignore,"Array"))for(var g=0,m=i.ignore.length;g<m;g++){var v=i.ignore[g];if(o.isOBJByType(v,"RegExp")&&v.test(l[1])||o.isOBJByType(v,"Function")&&v(u,l[1])){s=!0;break}}s||(i.offlineLog&&(i.id,i.uin,n=u,n=o.extend({id:i.id,uin:i.uin,time:new Date-0},n),r.db?r.addLog(n):(r.db||f.length||r.ready(function(e,t){t&&f.length&&(t.addLogs(f),f=[])}),f.push(n))),a||20==u.level||(i.prepareParams?p.push(l[3]):p.push(l[0]),i.onReport&&i.onReport(i.id,u)))}}e?h():d||(d=setTimeout(h,i.delay))}},m=e.BJ_REPORT={push:function(e){var n=o.isOBJ(e)?o.processError(e):{msg:e,time:Date.now()};if(i.ext&&!n.ext&&(n.ext=i.ext),n.from||(n.from=location.href),n._orgMsg){var r=n._orgMsg;delete n._orgMsg,n.level=2;var a=o.extend({},n);a.level=4,a.msg=r,t.push(n),t.push(a)}else t.push(n);return g(),m},report:function(e,t){return e&&m.push(e),t&&g(!0),m},info:function(e){return e?(o.isOBJ(e)?e.level=2:e={msg:e,level:2},m.push(e),m):m},debug:function(e){return e?(o.isOBJ(e)?e.level=1:e={msg:e,level:1},m.push(e),m):m},reportOfflineLog:function(){window.indexedDB?r.ready(function(e,t){if(t){var n=new Date-0-24*i.offlineLogExp*3600*1e3,r=new Date-0;t.getLogs({start:n,end:r,id:i.id,uin:i.uin},function(e,t){var o=document.createElement("iframe");o.name="badjs_offline_"+(new Date-0),o.frameborder=0,o.height=0,o.width=0,o.src="javascript:false;",o.onload=function(){var e=document.createElement("form");e.style.display="none",e.target=o.name,e.method="POST",e.action=i.offline_url||i.url.replace(/badjs$/,"offlineLog"),e.enctype.method="multipart/form-data";var s=document.createElement("input");s.style.display="none",s.type="hidden",s.name="offline_log",s.value=a()({logs:t,userAgent:navigator.userAgent,startDate:n,endDate:r,id:i.id,uin:i.uin}),o.contentDocument.body.appendChild(e),e.appendChild(s),e.submit(),setTimeout(function(){document.body.removeChild(o)},1e4),o.onload=null},document.body.appendChild(o)})}}):l.info("unsupport offlineLog")},offlineLog:function(e){return e?(o.isOBJ(e)?e.level=20:e={msg:e,level:20},m.push(e),m):m},init:function(e){if(o.isOBJ(e))for(var n in e)i[n]=e[n];var a=parseInt(i.id,10);return a&&(/qq\.com$/gi.test(location.hostname)&&(i.url||(i.url="//badjs2.qq.com/badjs"),i.uin||(i.uin=i.getUin?i.getUin(document.cookie):parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),i._reportUrl=i.prepareParams?i.url+"?f=json&":(i.url||"/badjs")+"?id="+a,i.uin),t.length&&g(),r._initing||(r._initing=!0,r.ready(function(e,t){t&&setTimeout(function(){t.clearDB(i.offlineLogExp),setTimeout(function(){var e;i.offlineLogAuto&&((e=document.createElement("script")).src=i.offline_auto_url||i.url.replace(/badjs$/,"offlineAuto")+"?id="+i.id+"&uin="+i.uin,window._badjsOfflineAuto=function(e){e&&l.reportOfflineLog()},document.head.appendChild(e))},5e3)},1e3)})),m},__onerror__:e.onerror};return"undefined"!=typeof console&&console.error&&setTimeout(function(){((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2]},0),m}(window);l.init({id:1,delay:1e3,url:"https://cube.weixinbridge.com/cube/report/reportbizdata",getUin:function(){return c+""},onReport:function(e,t){},prepareParams:function(e,t){var n=function(){var e=[],t=(location.href||"").replace(/\/@([^/]+)(\/)?/g,function(t,n,i){return e.push(n),"/@robot"+i});return{params:e.join("|"),page:t}}(),i=n.params,o=n.page;return e.forEach(function(e){var t=e.time;r()(e,{biz_id:1153,uin:c+"",module_id:"openai_pc",params:i,page:o,time:t&&parseInt(t/1e3)})}),t._reportUrl+"report_items="+encodeURIComponent(a()(e))}})},yp9N:function(e,t,n){"use strict";var i=n("gDS+"),r=n.n(i),o=n("EJiy"),a=n.n(o),s=n("14Xm"),u=n.n(s),c=n("FyfS"),l=n.n(c),f=n("4d7F"),p=n.n(f),d=n("D3Ub"),h=n.n(d),g=n("iCc5"),m=n.n(g),v=n("V7oC"),y=n.n(v),b=n("TikD");function k(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t.join("&")}var w="ae.weixin.qq.com",_="ai",B={ai:"/aesocket/openai/auth",webapp:"/aesocket/openai/webapp/auth",live:"/aesocket/openai/live/auth"},E={ai:"/aesocket/openai/heartbeat",webapp:"/aesocket/openai/webapp/heartbeat",live:"/aesocket/openai/live/heartbeat"},O={ai:"/aesocket/openai/msg",webapp:"/aesocket/openai/webapp/msg",live:"/aesocket/openai/live/msg"},T=function(){function e(t){var n=t.timeout,i=t.type;m()(this,e),this.timeout=n||1e4,this.type=i||_,this.heartbeatId=0,this.seq=0,this.socket=null,this.initialized=!1,this.deviceid=Object(b.c)(),this.aeuri="wss://"+w,this.token=null,this.handlers=[],this.lockReconnect=!1,this.reconectNum=0}return y()(e,[{key:"getAuthpath",value:function(){var e=this.type||_;return B[e]}},{key:"getHeartbeatpath",value:function(){var e=this.type||_;return E[e]}},{key:"getMessagepath",value:function(){var e=this.type||_;return O[e]}},{key:"init",value:function(){var e=h()(u.a.mark(function e(){var t=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.socket&&1===this.socket.readyState){e.next=3;break}return this.socket=new WebSocket(this.aeuri),e.abrupt("return",new p.a(function(e){t.socket.addEventListener("open",function(){t.initialized=!0,e()}),t.socket.addEventListener("message",function(e){var n=!0,i=!1,r=void 0;try{for(var o,a=l()(t.handlers);!(n=(o=a.next()).done);n=!0){var s=o.value;"function"==typeof s&&s(e)}}catch(e){i=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}}),t.socket.addEventListener("error ",function(e){t.reconnect()})}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"auth",value:function(){var e=h()(u.a.mark(function e(t,n){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.initialized&&(this.socket.close(),this.initialized=!1,clearInterval(this.heartbeatId)),this.token=t,this.api({method:"post",path:this.getAuthpath(),content:""},n),this.heartbeatId=setTimeout(this.heartbeat.bind(this),this.timeout);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=h()(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.api({method:"post",path:this.getMessagepath(),content:t});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onmessage",value:function(e){this.handlers.includes(e)||this.handlers.push(e)}},{key:"heartbeat",value:function(){this.api({method:"post",path:this.getHeartbeatpath(),content:""}),this.heartbeatId=setTimeout(this.heartbeat.bind(this),this.timeout)}},{key:"api",value:function(){var e=h()(u.a.mark(function e(t,n){var i,o,s=t.method,c=t.path,l=t.content;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i="token="+this.token+"&deviceid="+this.deviceid,n&&"object"===(void 0===n?"undefined":a()(n))&&(i=i+"&"+k(n)),o=r()({cmd:0,product:4901,seq:this.seq++,http:{method:s,path:c,header:{host:w},query:i},content:l}),this.initialized){e.next=6;break}return e.next=6,this.init();case 6:this.socket.send(o);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearHandlers",value:function(){this.handlers=[]}},{key:"destory",value:function(){this.socket&&this.socket.close()}},{key:"reconnect",value:function(){var e=this;this.lockReconnect||(this.lockReconnect=!0,this.reconectNum<3&&setTimeout(function(){e.socket?(e.socket.close(),e.init()):e.init(),e.reconectNum++,e.lockReconnect=!1},2e3))}}]),e}();t.a={Notify:T,AISOCKET_TYPE:_,WEBAPPSOCKET_TYPE:"webapp",LIVESOCKET_TYPE:"live"}}}]);